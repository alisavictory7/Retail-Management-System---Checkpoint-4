@startuml Use Case Diagram - Retail CP4

!theme plain
skinparam usecaseStyle rectangle
skinparam actorStyle awesome
skinparam dpi 120
skinparam usecaseBackgroundColor #E3F2FD
skinparam usecaseBorderColor #1976D2
skinparam actorBackgroundColor #FFEBEE
skinparam actorBorderColor #D32F2F
skinparam packageBackgroundColor #F5E8FF
skinparam packageBorderColor #8E44AD
skinparam noteBackgroundColor #FFF3CD
skinparam noteBorderColor #856404

left to right direction

actor Customer
actor "Store Admin" as Admin
actor "Partner / VAR" as Partner
actor "Payment Gateway" as PaymentService

rectangle "Storefront" {
    usecase "Browse Catalog" as UC_Browse
    usecase "Manage Shopping Cart" as UC_Cart
    usecase "Checkout Order" as UC_Checkout
    usecase "Track Order Status" as UC_OrderStatus
}

rectangle "Order History (CP4)" #E8F5E9 {
    usecase "View Order History" as UC_OrderHistory
    usecase "Filter by Status/Date" as UC_FilterHistory
    usecase "Search Orders by Keyword" as UC_SearchOrders
}

rectangle "Returns & Refunds" {
    usecase "Submit Return Request" as UC_ReturnRequest
    usecase "Upload Return Photos" as UC_ReturnPhotos
    usecase "Track RMA Status" as UC_ReturnTrack
    usecase "Review Request" as UC_ReviewReturn
    usecase "Authorize / Reject RMA" as UC_Authorize
    usecase "Record Inspection" as UC_Inspection
    usecase "Trigger Refund / Replacement" as UC_Refund
}

rectangle "Notifications (CP4)" #FFF8E1 {
    usecase "Receive RMA Status Notification" as UC_RMANotification
    usecase "View Notification Panel" as UC_ViewNotifications
    usecase "Mark Notifications Read" as UC_MarkRead
}

rectangle "Admin & Observability" {
    usecase "View Unified Dashboard" as UC_Dashboard
    usecase "Manage Users" as UC_UserAdmin
    usecase "Manage Store" as UC_ManageStore
    usecase "Manage Products" as UC_ProductAdmin
    usecase "Create Flash Sales" as UC_FlashSales
    usecase "View Low Stock Alerts" as UC_LowStockAlerts
    usecase "Interactive Quality Scenario Testing" as UC_QualityMonitoring
    usecase "Live Test A.1 Availability" as UC_TestA1
    usecase "Live Test P.1 Performance" as UC_TestP1
    usecase "Manage Returns" as UC_ReturnsAdmin
}

rectangle "Partner (VAR) Catalog Ingest" #FFF3E0 {
    usecase "Sync Partner Catalog" as UC_PartnerSync
    usecase "Validate Partner Feed" as UC_PartnerValidate
    usecase "Upload CSV/JSON Feed" as UC_UploadFeed
    usecase "Manage Partners" as UC_ManagePartners
    usecase "Schedule Periodic Sync" as UC_ScheduleSync
    usecase "View Catalog Statistics" as UC_CatalogStats
}

Customer --> UC_Browse
Customer --> UC_Cart
Customer --> UC_Checkout
Customer --> UC_OrderStatus
Customer --> UC_OrderHistory
Customer --> UC_ReturnRequest
Customer --> UC_ReturnPhotos
Customer --> UC_ReturnTrack
Customer --> UC_RMANotification
Customer --> UC_ViewNotifications
Customer --> UC_MarkRead

Admin --> UC_ReviewReturn
Admin --> UC_Authorize
Admin --> UC_Inspection
Admin --> UC_Refund
Admin --> UC_Dashboard
Admin --> UC_UserAdmin
Admin --> UC_ManageStore
Admin --> UC_ReturnsAdmin
Admin --> UC_QualityMonitoring

Partner --> UC_PartnerSync
Partner --> UC_PartnerValidate

Admin --> UC_ManagePartners
Admin --> UC_UploadFeed
Admin --> UC_ScheduleSync
Admin --> UC_CatalogStats

PaymentService --> UC_Checkout
PaymentService --> UC_Refund

UC_Checkout ..> UC_Cart : <<includes>>
UC_ReturnRequest ..> UC_ReturnPhotos : <<optional>>
UC_Refund ..> UC_Inspection : <<requires>>
UC_Dashboard ..> UC_QualityMonitoring : <<includes>>
UC_Dashboard ..> UC_UserAdmin : <<portal>>
UC_Dashboard ..> UC_ManageStore : <<portal>>
UC_Dashboard ..> UC_ReturnsAdmin : <<portal>>
UC_ManageStore ..> UC_ProductAdmin : <<includes>>
UC_ManageStore ..> UC_FlashSales : <<includes>>
UC_ManageStore ..> UC_LowStockAlerts : <<includes>>
UC_OrderHistory ..> UC_FilterHistory : <<optional>>
UC_OrderHistory ..> UC_SearchOrders : <<optional>>
UC_Authorize ..> UC_RMANotification : <<triggers>>
UC_Inspection ..> UC_RMANotification : <<triggers>>
UC_Refund ..> UC_RMANotification : <<triggers>>
UC_UploadFeed ..> UC_PartnerValidate : <<includes>>
UC_PartnerSync ..> UC_PartnerValidate : <<includes>>
UC_ManagePartners ..> UC_ScheduleSync : <<optional>>
UC_ManageStore ..> UC_ManagePartners : <<includes>>

note right of UC_Refund
  Refund Execution
  - Card/original method passes through payment gateway
  - Cash / store credit handled manually
  - Partial approvals keep audit notes
end note

note right of UC_ManageStore
  Unified Store Management
  - Product inventory CRUD
  - Flash sale creation
  - Low stock alerts (Pub-Sub)
  - Tabbed interface design
end note

note right of UC_Dashboard
  Unified Admin Dashboard
  - Portal cards for quick access
  - User/Store/Returns management
  - Business metrics & KPIs
  - Quality scenario monitoring
end note

note right of UC_QualityMonitoring
  CP4: Interactive Quality Monitoring
  - Live test A.1 (Circuit Breaker)
  - Live test P.1 (Throttling)
  - Configurable sliders & switches
  - Real-time test results log
end note

UC_QualityMonitoring ..> UC_TestA1 : <<includes>>
UC_QualityMonitoring ..> UC_TestP1 : <<includes>>

note right of UC_OrderHistory
  CP4 Feature 2.1
  - Filter by status, date range
  - Keyword search across orders
  - Layered HistoryService abstraction
end note

note right of UC_RMANotification
  CP4 Feature 2.3
  - Pub-Sub pattern for status changes
  - In-app notification panel
  - Badge count in navbar
end note

note right of UC_ManagePartners
  CP2: Partner (VAR) Catalog Ingest
  - Add/edit/delete partners
  - Upload CSV/JSON feeds
  - Configure sync schedules
  - ADR 6: Authenticate Actors
  - ADR 7: Validate Input
  - ADR 9: Adapter Pattern
end note

@enduml
