@startuml Package Diagram - CP4 Architecture

!theme plain
skinparam packageStyle rectangle
skinparam dpi 120
skinparam packageBackgroundColor #F4ECFE
skinparam packageBorderColor #6C3FA7
skinparam noteBackgroundColor #FFF3CD
skinparam noteBorderColor #856404

left to right direction

package "Core Platform" {
    [main.py] as Main
    [models.py] as Models
    [database.py] as Database
}

package "Experience Layer" {
    [blueprints/returns.py] as ReturnsBP
    [templates/] as Templates
}

package "Domain Services" {
    [returns_service.py] as ReturnsSvc
    [refund_service.py] as RefundSvc
    [inventory_service.py] as InventorySvc
}

package "CP4 Feature Services" #E8F5E9 {
    [history_service.py] as HistorySvc
    [low_stock_alert_service.py] as LowStockSvc
    [notification_service.py] as NotificationSvc
}

package "Reliability & Observability" {
    [tactics/manager.py] as TacticsManager
    [observability/metrics.py] as Metrics
}

Main --> ReturnsBP
ReturnsBP --> ReturnsSvc
ReturnsBP --> Templates
ReturnsSvc --> RefundSvc
ReturnsSvc --> InventorySvc
ReturnsSvc --> Models
InventorySvc --> Models

Main --> HistorySvc : /order-history
Main --> LowStockSvc : /admin/dashboard
Main --> NotificationSvc : /api/notifications
HistorySvc --> Models
LowStockSvc --> Models
NotificationSvc ..> ReturnsSvc : Pub-Sub
InventorySvc ..> LowStockSvc : Pub-Sub

Main --> TacticsManager
TacticsManager --> Metrics

note right of HistorySvc
  CP4 Feature 2.1
  Order History Filtering
  - Status/date/keyword filters
  - Layers Pattern
end note

note right of LowStockSvc
  CP4 Feature 2.2
  Low Stock Alerts
  - Pub-Sub subscriber
  - Configurable threshold
end note

note right of NotificationSvc
  CP4 Feature 2.3
  RMA Notifications
  - In-memory store
  - Navbar badge
end note

@enduml
